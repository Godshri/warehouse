<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Умный склад</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#0d6efd">
    <link rel="stylesheet" href="/static/styles.css">
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <span class="navbar-brand">Умный склад</span>
      </div>
    </nav>

    <main class="container py-4">
      <div class="row g-3">
        <div class="col-lg-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Вход</h5>
              <form id="login-form">
                <div class="mb-2">
                  <input class="form-control" name="username" placeholder="Логин" required>
                </div>
                <div class="mb-2">
                  <input class="form-control" type="password" name="password" placeholder="Пароль" required>
                </div>
                <button class="btn btn-primary w-100" type="submit">Войти</button>
              </form>
              <div class="text-muted small mt-2" id="login-status">Требуется авторизация</div>
            </div>
          </div>

          <div class="card mt-3">
            <div class="card-body">
              <h5 class="card-title">Сканирование QR</h5>
              <div id="qr-reader" class="mb-2"></div>
              <input class="form-control mb-2" id="manual-qr" placeholder="Вставьте QR/UUID вручную">
              <button class="btn btn-outline-primary w-100" id="scan-button">Найти оборудование</button>
              <div class="mt-2 small" id="scan-result"></div>
            </div>
          </div>

          <div class="card mt-3">
            <div class="card-body">
              <h5 class="card-title">Выдача</h5>
              <form id="issue-form">
                <input class="form-control mb-2" name="equipment_id" placeholder="UUID оборудования" required>
                <input class="form-control mb-2" name="target_user_id" placeholder="ID получателя" required>
                <input class="form-control mb-2" type="datetime-local" name="due_at" placeholder="Срок возврата">
                <input class="form-control mb-2" name="notes" placeholder="Комментарий">
                <button class="btn btn-success w-100" type="submit">Выдать</button>
              </form>
              <div class="small mt-2" id="issue-result"></div>
            </div>
          </div>

          <div class="card mt-3">
            <div class="card-body">
              <h5 class="card-title">Возврат</h5>
              <form id="return-form">
                <input class="form-control mb-2" name="equipment_id" placeholder="UUID оборудования" required>
                <select class="form-select mb-2" name="condition">
                  <option value="ok">Исправно</option>
                  <option value="need_repair">Требует ремонта</option>
                  <option value="damaged">Повреждено</option>
                </select>
                <input class="form-control mb-2" name="notes" placeholder="Комментарий">
                <button class="btn btn-warning w-100" type="submit">Принять</button>
              </form>
              <div class="small mt-2" id="return-result"></div>
            </div>
          </div>

          <div class="card mt-3">
            <div class="card-body">
              <h5 class="card-title">Инвентаризация</h5>
              <form id="inventory-start-form" class="mb-2">
                <input class="form-control mb-2" name="location" placeholder="ID локации (необязательно)">
                <button class="btn btn-outline-primary w-100" type="submit">Начать</button>
              </form>
              <div class="input-group mb-2">
                <input class="form-control" id="inventory-scan-id" placeholder="UUID для сканирования">
                <button class="btn btn-outline-secondary" id="inventory-scan">Скан</button>
              </div>
              <button class="btn btn-outline-danger w-100" id="inventory-finish">Завершить</button>
              <div class="small mt-2" id="inventory-result"></div>
            </div>
          </div>
        </div>

        <div class="col-lg-8">
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Оборудование</h5>
                <button class="btn btn-sm btn-outline-secondary" id="refresh-equipment">Обновить</button>
              </div>
              <div class="table-responsive mt-3">
                <table class="table table-sm align-middle">
                  <thead>
                    <tr>
                      <th>UUID</th>
                      <th>Наименование</th>
                      <th>Статус</th>
                      <th>Местоположение</th>
                    </tr>
                  </thead>
                  <tbody id="equipment-list"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="card mt-3">
            <div class="card-body">
              <h5 class="card-title">Отчеты и статистика</h5>
              <div class="d-flex gap-2 flex-wrap mb-2">
                <button class="btn btn-sm btn-outline-secondary" id="load-stats">Загрузить статистику</button>
                <button class="btn btn-sm btn-outline-secondary" id="download-report-csv">CSV отчет</button>
                <button class="btn btn-sm btn-outline-secondary" id="download-report-xlsx">XLSX отчет</button>
              </div>
              <canvas id="stats-chart" height="120"></canvas>
            </div>
          </div>

          <div class="card mt-3">
            <div class="card-body">
              <h5 class="card-title">Уведомления</h5>
              <div class="d-flex gap-2 flex-wrap mb-2">
                <button class="btn btn-sm btn-outline-secondary" id="load-notifications">Обновить</button>
                <button class="btn btn-sm btn-outline-secondary" id="mark-notifications-read">Пометить прочитанными</button>
                <button class="btn btn-sm btn-outline-secondary" id="load-overdue">Просрочки</button>
              </div>
              <ul class="list-group list-group-flush" id="notifications-list"></ul>
              <div class="small mt-2" id="overdue-result"></div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8"></script>
    <script src="/static/app.js"></script>
  </body>
</html>
